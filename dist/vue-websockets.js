!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VueWebsockets=t():e.VueWebsockets=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return k}));var i={beforeCreate(){this.sockets||(this.sockets={}),this.sockets.subscribe=(e,t)=>{this.$vueWebsockets.emitter.addListener(e,t,this)},this.sockets.unsubscribe=e=>{this.$vueWebsockets.emitter.removeListener(e,this)}},mounted(){this.$options.sockets&&Object.keys(this.$options.sockets).forEach(e=>{"subscribe"!==e&&"unsubscribe"!==e&&this.$vueWebsockets.emitter.addListener(e,this.$options.sockets[e],this)})},beforeDestroy(){this.$options.sockets&&Object.keys(this.$options.sockets).forEach(e=>{this.$vueWebsockets.emitter.removeListener(e,this)})}};function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.debug=!1,this.prefix="%cVue-Websockets: "}var t,n,i;return t=e,(n=[{key:"info",value:function(e,t=""){this.debug&&window.console.info(this.prefix+"%c"+e,"color: lightgreen;",t)}},{key:"error",value:function(){this.debug&&window.console.error(this.prefix,...arguments)}},{key:"warn",value:function(){this.debug&&window.console.warn(this.prefix,...arguments)}},{key:"event",value:function(e,t=""){this.debug&&window.console.info(this.prefix+"%c"+e,"color: lightgreen;",t)}}])&&o(t.prototype,n),i&&o(t,i),e}());function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}let a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.wsWrapper=t,this.emitter=n,this.register()}var t,n,i;return t=e,(n=[{key:"register",value:function(){e.staticEvents.forEach(e=>this.wsWrapper.ws["on"+e]=e=>{const{type:t,data:n}=e,i=n&&JSON.parse(n)||null;"open"===t&&this.wsWrapper.executeTaskBuffer(),"close"===t&&this.wsWrapper.reconnect(()=>{this.register(),this.emitter.emit("RECONNECT")}),this.onEvent(t,i),i&&i.type&&this.onEvent(i.type,i.data)})}},{key:"onEvent",value:function(e,t){this.emitter.emit(e.toUpperCase(),t)}}])&&r(t.prototype,n),i&&r(t,i),e}();var c,u,f;function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}f=["open","message","error","close"],(u="staticEvents")in(c=a)?Object.defineProperty(c,u,{value:f,enumerable:!0,configurable:!0,writable:!0}):c[u]=f;let h=function(){function e(t={}){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s.info(t?"Vuex adapter enabled":"Vuex adapter disabled"),s.info(t.mutationPrefix?"Vuex socket mutations enabled":"Vuex socket mutations disabled"),s.info(t?"Vuex socket actions enabled":"Vuex socket actions disabled"),this.store=t.store,this.actionPrefix=t.actionPrefix?t.actionPrefix:"SOCKET_",this.mutationPrefix=t.mutationPrefix,this.listeners=new Map}var t,n,i;return t=e,(n=[{key:"addListener",value:function(e,t,n){if("function"!=typeof t)throw new Error("callback must be a function");this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push({callback:t,component:n}),s.info(`#${e} subscribe, component: ${n.$options.name}`)}},{key:"removeListener",value:function(e,t){if(this.listeners.has(e)){const n=this.listeners.get(e).filter(e=>e.component!==t);n.length>0?this.listeners.set(e,n):this.listeners.delete(e),s.info(`#${e} unsubscribe, component: ${t.$options.name}`)}}},{key:"emit",value:function(e,t){"ping"!==e&&"pong"!==e&&this.dispatchStore(e,t),this.listeners.has(e)&&(s.info(`Broadcasting: #${e}, Data:`,t),this.listeners.get(e).forEach(e=>{e.callback.call(e.component,t)}))}},{key:"dispatchStore",value:function(e,t){if(this.store&&this.store._mutations){let n=this.mutationPrefix+e;for(let e in this.store._mutations)e.split("/").pop()===n&&(s.info(`Commiting Mutation: ${e}, Data:`,t),this.store.commit(e,t))}if(this.store&&this.store._actions){let n=this.actionPrefix+e;for(let e in this.store._actions)e.split("/").pop()===n&&(s.info(`Dispatching Action: ${e}, Data:`,t),this.store.dispatch(e,t))}}}])&&l(t.prototype,n),i&&l(t,i),e}();function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}let b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.connectionUrl=t,this.ws=new WebSocket(t),this.taskBuffer=[],this.jwtToken=null,this.RECONNECT_TIMEOUT=5e3}var t,n,i;return t=e,(n=[{key:"executeTaskBuffer",value:function(){for(let e=this.taskBuffer.length-1;e>=0;e-=1)this.send(this.taskBuffer[e]),this.taskBuffer.splice(e,1)}},{key:"setJwtToken",value:function(e){this.jwtToken=e}},{key:"send",value:function(e){e.jwt_token||(e.jwt_token=this.jwtToken),this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):this.taskBuffer.push(e)}},{key:"reconnect",value:function(e){setTimeout(()=>{this.ws=new WebSocket(this.connectionUrl),e()},this.RECONNECT_TIMEOUT)}}])&&p(t.prototype,n),i&&p(t,i),e}();function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}let k=function(){function e({connectionUrl:t,vuex:n,debug:i}){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s.debug=i,this.emitter=new h(n),this.wsWrapper=new b(t),this.listener=new a(this.wsWrapper,this.emitter)}var t,n,o;return t=e,(n=[{key:"install",value:function(e){e.prototype.$socket=this.wsWrapper,e.prototype.$vueWebsockets=this,e.mixin(i),s.info("Vue-Websockets plugin enabled")}}])&&d(t.prototype,n),o&&d(t,o),e}()}]).default}));